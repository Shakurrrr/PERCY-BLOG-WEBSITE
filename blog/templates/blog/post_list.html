{% extends "base.html" %}
{% block title %}Posts{% endblock %}
{% block content %}

<!-- Hero -->
<section class="mb-8 rounded-2xl bg-gradient-to-r from-teal-50 to-blue-50 border border-gray-200 p-6">
  <div class="flex items-center justify-between gap-6 flex-wrap">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Latest posts</h1>
      <p class="text-gray-600 mt-1">Insights, tutorials, and product updates.</p>
    </div>
    <form method="get" action="{% url 'blog:post_list' %}" class="w-full sm:w-auto">
      <input name="q" value="{{ request.GET.q }}" placeholder="Search posts"
             class="w-full sm:w-80 rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"/>
    </form>
  </div>
</section>

{% if page_obj.object_list %}
  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for post in page_obj.object_list %}
    <article class="bg-white rounded-2xl shadow-md ring-1 ring-gray-200 overflow-hidden hover:shadow-lg transition">
      <a href="{% url 'blog:post_detail' slug=post.slug %}">
        {% if post.featured_image %}
          <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-44 object-cover">
        {% else %}
          <img src="https://picsum.photos/seed/{{ post.slug }}/800/400" alt="{{ post.title }}" class="w-full h-44 object-cover">
        {% endif %}
      </a>
      <div class="p-4">
        <a class="text-lg font-semibold hover:underline" href="{% url 'blog:post_detail' slug=post.slug %}">{{ post.title }}</a>
        <p class="text-xs text-gray-500 mt-1">in {{ post.category.name }} Â· {{ post.published_at|date:"M d, Y" }}</p>
        {% if post.excerpt %}
          <p class="mt-2 text-sm text-gray-700 line-clamp-3">{{ post.excerpt }}</p>
        {% endif %}
        <div class="mt-3 flex flex-wrap gap-1">
          {% for tag in post.tags.all %}
            <a href="{% url 'blog:post_by_tag' slug=tag.slug %}" class="px-2 py-0.5 rounded-full text-xs bg-gray-100 hover:bg-gray-200">#{{ tag.name }}</a>
          {% endfor %}
        </div>
      </div>
    </article>
    {% endfor %}
  </div>

  <div class="mt-8 flex items-center gap-2">
    {% if page_obj.has_previous %}
      <a class="px-3 py-1 border rounded-md hover:bg-gray-50" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ page_obj.previous_page_number }}">Prev</a>
    {% endif %}
    <span class="px-3 py-1 border rounded-md">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="px-3 py-1 border rounded-md hover:bg-gray-50" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
    {% endif %}
  </div>
{% else %}
  <div class="bg-white p-8 rounded-2xl shadow text-center">
    <p class="text-gray-700">No posts yet.</p>
    {% if perms.blog.add_post %}
      <a class="inline-block mt-4 px-4 py-2 bg-blue-600 text-white rounded-md" href="{% url 'blog:post_create' %}">Create your first post</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
